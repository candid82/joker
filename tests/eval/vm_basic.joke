;; Basic VM tests

(ns joker.test.vm-basic
  (:require [joker.test :refer [deftest is testing]]))

;; Note: These tests will initially run via the AST evaluator.
;; Once VM integration is complete, they will serve as regression tests.

(deftest test-arithmetic
  (testing "basic arithmetic"
    (is (= 3 (+ 1 2)))
    (is (= 10 (+ 1 2 3 4)))
    (is (= -1 (- 3 4)))
    (is (= 6 (* 2 3)))
    (is (= 2 (/ 6 3)))))

(deftest test-comparison
  (testing "comparison operators"
    (is (< 1 2))
    (is (> 3 2))
    (is (= 1 1))
    (is (not= 1 2))
    (is (<= 1 1))
    (is (<= 1 2))
    (is (>= 2 2))
    (is (>= 3 2))))

(deftest test-conditionals
  (testing "if expressions"
    (is (= 1 (if true 1 2)))
    (is (= 2 (if false 1 2)))
    (is (= 3 (if nil 1 3)))
    (is (= 1 (if 0 1 2)))  ; 0 is truthy in Clojure
    (is (= 1 (if "" 1 2))))) ; empty string is truthy

(deftest test-let-bindings
  (testing "let expressions"
    (is (= 3 (let [x 1 y 2] (+ x y))))
    (is (= 6 (let [x 1 y 2 z 3] (+ x y z))))
    (is (= 10 (let [x 5] (let [y 5] (+ x y)))))))

(deftest test-loop-recur
  (testing "loop and recur"
    (is (= 55 (loop [n 10 acc 0]
                (if (= n 0)
                  acc
                  (recur (- n 1) (+ acc n))))))))

(deftest test-fn
  (testing "function definition and calls"
    (is (= 5 ((fn [x] (+ x 3)) 2)))
    (is (= 10 ((fn [a b] (+ a b)) 4 6)))))

(deftest test-closures
  (testing "closures"
    (is (= 15 (let [x 10]
                ((fn [y] (+ x y)) 5))))))

(deftest test-vectors
  (testing "vector literals"
    (is (= [1 2 3] [1 2 3]))
    (is (= 3 (count [1 2 3])))))

(deftest test-maps
  (testing "map literals"
    (is (= {:a 1 :b 2} {:a 1 :b 2}))
    (is (= 1 (:a {:a 1 :b 2})))))

(deftest test-sets
  (testing "set literals"
    (is (= #{1 2 3} #{1 2 3}))
    (is (contains? #{1 2 3} 2))))
